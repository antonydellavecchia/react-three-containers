(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{12:function(e,t,n){"use strict";n.r(t);var i=n(7),o=n(6),r=n(1),a=n.n(r),s=n(0),c=n(4),u=n.n(c),v=n(5),l=n(2),d=n(3),f=function e(t){var n=this,i=t.url,o=t.stepSize,r=void 0===o?.01:o;Object(l.a)(this,e),this.play=function(){console.log("play audio"),n.mediaElement.play()},this.pause=function(){console.log("pause mediaElement"),n.mediaElement.pause()},this.animate=function(){n.analyser.getFrequencyData(),n.uniforms.time.value+=n.stepSize,n.uniforms.tAudioData.value.needsUpdate=!0};this.mediaElement=new Audio(i);var a=new s.c;this.stepSize=r,this.audio=new s.a(a),this.audio.hasPlaybackControl=!0,this.audio.setMediaElementSource(this.mediaElement),this.analyser=new s.b(this.audio,128),this.uniforms={time:{value:0},tAudioData:{value:new s.d(this.analyser.data,64,1,s.f)}}},h="#define GLSLIFY 1\nvarying vec4 vUv;\nfloat magnitude(vec3 pos) {\n  return pow(pow(pos.x, 2.0) + pow(pos.y, 2.0) + pow(pos.z, 2.0), 0.5);\n}\nvoid main() {\n  vUv = vec4(position, 1.0);\n  vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix * modelViewPosition;\n}\n",p=function(e){var t=e.geometry,n=void 0===t?new s.i(10,10,10):t,i=e.uniforms,o=void 0===i?null:i,r=e.vertexShader,a=void 0===r?h:r,c=e.fragmentShader,u=void 0===c?"#define GLSLIFY 1\nuniform sampler2D tAudioData;\nvarying vec4 vUv;\nfloat rand(vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\nvoid main() {\n  float random1 = rand(vec2(vUv.x, vUv.y));\n  float random2 = rand(vec2(vUv.x, vUv.z));\n  float M_PI = 3.1415926535897932384626433832795;\n  float f =  texture2D( tAudioData, vec2( 0.5 + 0.5 * sin(M_PI * vUv.x) * cos(2.0 * M_PI * vUv.y), 0.0) ).g;\n  //float f = texture2D( tAudioData, vec2((random1 * abs(vUv.x) * random2 * abs(vUv.y)), 0.0 ) ).g;\n  float radius = 0.5;\n  //vec3 backgroundColor = vec3( min(vUv.y, f), min(radius, f), min((f / 10.0), 0.1) );\n  //vec3 backgroundColor = vec3( min(abs(vUv.y), 1.0), f, min((f / 10.0), 0.1) );\n  //vec3 backgroundColor = vec3( (vUv.z), 1.0), min(1.0 - abs(vUv.z), random1) * f, 0.0 );\n  vec3 backgroundColor = vec3(abs(vUv.x) / length(vUv.xyz), abs(vUv.y) / length(vUv.xyz) , abs(vUv.z) / length(vUv.xyz));\n  float red  = min(vUv.y / 4.0, 1.0);\n  vec3 color = vec3( red, sin(f), cos(f));\n  float i = step(radius, f) * step(radius, f - 0.5);\n  //gl_FragColor = vec4( mix(color, backgroundColor, i), 1.0 );\n\n  gl_FragColor = vec4(backgroundColor, 0.0);\n  //gl_FragColor = vec4(vec3(1,0,0), 1.0);\n  gl_FragColor.a = f;\n}\n":c;return new s.g(n,function(e){var t=e.uniforms,n=void 0===t?null:t,i=e.vertexShader,o=e.fragmentShader;return console.log("uniforms",n),new s.k({uniforms:n,vertexShader:i,fragmentShader:o,transparent:!0,opacity:.5,side:s.e})}({uniforms:o,vertexShader:a,fragmentShader:u}))},m=function(e){var t=e.pos1,n=void 0===t?{x:0,y:0,z:0}:t,i=e.pos2,o=void 0===i?{x:0,y:0,z:0}:i;return Math.sqrt(Object.keys(n).reduce((function(e,t){return e+Math.pow(n[t]-o[t],2)}),0))},y=function(e){return 0};var g=function(){function e(t){Object(l.a)(this,e);var n=function(e){switch(e){case"CIRCLEXY_SINEZ":return{x:function(e){return-e.y},y:function(e){return e.x},z:function(e){var t=m({pos1:e}),n=e.y/t;return Math.cos(Math.asin(n))/Math.sqrt(1-Math.pow(n,2))*e.x}};case"CIRCLEXZ":return{x:function(e){return e.z},z:function(e){return-e.x}};case"RANDOM":return{x:function(e){return e.x*e.z},y:function(e){return-e.z},z:function(e){return-e.z}};case"LORENZ":return{x:function(e){return 28*(e.y-e.x)},y:function(e){return e.x*(28-e.z)-e.y},z:function(e){return e.x*e.y-8/3*e.z}};default:return{x:y,y:y,z:y}}}(t),i=n.x,o=void 0===i?y:i,r=n.y,a=void 0===r?y:r,s=n.z,c=void 0===s?y:s;this.x=o,this.y=a,this.z=c}return Object(d.a)(e,[{key:"flow",value:function(e){var t=e.position,n=e.stepSize,i=void 0===n?.01:n;return{x:t.x+this.x(t)*i,y:t.y+this.y(t)*i,z:t.z+this.z(t)*i}}}]),e}(),x=function(){function e(t){var n=t.geometry,i=t.name,o=t.position,r=void 0===o?{x:0,y:0,z:0}:o,a=t.vertexShader,s=void 0===a?h:a,c=t.fragmentShader,u=t.vectorFieldConfig;Object(l.a)(this,e),this.geometry=n,this.name=i,this.position=r,this.vertexShader=s,this.fragmentShader=c,this.vectorField=new g(u)}return Object(d.a)(e,[{key:"initMesh",value:function(e){var t=p({uniforms:e,geometry:this.geometry,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader});return t.name=this.name,t.position.set(this.position.x,this.position.y,this.position.z),this.mesh=t,t}},{key:"animate",value:function(e){var t=this.mesh.position,n=this.vectorField.flow({position:t,stepSize:e});this.mesh.position.set(n.x,n.y,n.z)}}]),e}();function w(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:""){case"SQUARE":return[0,1,2,3].map((function(e){var t=2*Math.PI*e/4;return{x:Math.cos(t),y:Math.sin(t),z:0}}));case"SQUARE_SUSPENSION":return[0,1,2,3,4,5].map((function(e){return{x:e%3==0?Math.pow(-1,e%2):0,y:e%3==1?Math.pow(-1,e%2):0,z:e%3==2?Math.pow(-1,e%2):0}}));default:return{x:0,y:0,z:5}}}var b=function(){function e(t){var n=t.name,i=t.focus,o=void 0===i?{x:0,y:0,z:0}:i,r=t.vectorField,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;Object(l.a)(this,e);var s=w(n);this.config=n,this.dist=a,this.positions=s.map((function(e){return{x:a*e.x+o.x,y:a*e.y+o.y,z:a*e.z+o.z}})),this.focus=o,this.number=0,this.vectorField=new g(r),console.log(this.positions)}return Object(d.a)(e,[{key:"flow",value:function(e){var t=this.focus,n=this.vectorField.flow({position:t,stepSize:e});this.positions=this.positions.map((function(e){return{x:e.x+n.x-t.x,y:e.y+n.y-t.y,z:e.z+n.z-t.z}})),this.focus=n}},{key:"resetFocus",value:function(e){var t=this,n=w(this.config);this.positions=n.map((function(n){return{x:t.dist*n.x+e.x,y:t.dist*n.y+e.y,z:t.dist*n.z+e.z}})),this.focus=e}},{key:"follow",value:function(e,t){this.resetFocus(e),this.vectorField=t}},{key:"activePosition",value:function(){return this.positions[this.number]}},{key:"switch",value:function(e){this.number=e}},{key:"next",value:function(){this.number=(this.number+1)%this.positions.length}},{key:"setVectorField",value:function(e){this.vectorField=e}}]),e}(),z=function(){function e(t){var n=t.width,i=t.height,o=t.models;Object(l.a)(this,e),this.scene=new s.j,this.camera=new s.h(75,n/i,.1,1e3),this.renderer=new s.m({antialias:!0}),this.renderer.setClearColor("#000000"),this.renderer.setSize(n,i),this.models=o.map((function(e){return new x(e)})),this.cameraGroup=new b({name:"SQUARE_SUSPENSION",focus:{x:0,y:-10,z:0}},30),this.step=0,console.log(this.scene)}return Object(d.a)(e,[{key:"cameraAnimate",value:function(e){var t=this.cameraGroup.activePosition(),n=t.x,i=t.y,o=t.z;this.camera.position.z=o,this.camera.position.x=n,this.camera.position.y=i,this.camera.lookAt(this.cameraGroup.focus.x,this.cameraGroup.focus.y,this.cameraGroup.focus.z),this.camera.up.set(0,0,1),this.cameraGroup.flow(e)}},{key:"renderScene",value:function(){this.cameraAnimate(),this.models.forEach((function(e){return e.animate()})),this.renderer.render(this.scene,this.camera),this.audio.animate(),this.step>30?(this.cameraGroup.next(),this.step=0):this.step+=1}},{key:"play",value:function(){this.audio.play(),this.cameraGroup.switch(2)}},{key:"pause",value:function(){this.audio.pause()}},{key:"add",value:function(e){var t=this;console.log("adding objects"),e.forEach((function(e){t.scene.add(e)}))}},{key:"loadAudioObject",value:function(){var e=Object(v.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.audio=new f(t),console.log(this.audio,"audio"),e.abrupt("return",this.audio);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadMeshes",value:function(e){var t=this;this.models.forEach((function(n){var i=n.initMesh(e);t.scene.add(i)}))}},{key:"handleResize",value:function(e,t){this.renderer.setSize(e,t),this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderScene()}}]),e}();function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}var O=a.a.createContext(),j=function(e){var t=e.reducer,n=e.initialState,i=e.children,c=Object(r.useReducer)(t,n),l=Object(o.a)(c,2),d=l[0],f=function(e,t){return{loadAudio:function(){var e=Object(v.a)(u.a.mark((function e(n,i){var o,r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(n),o=new s.c,r=new s.a(o),a=new s.b(r,i),e.next=6,r.setMediaElementSource(n);case 6:t({type:"SET_MEDIA",payload:n}),t({type:"SET_ANALYSER",payload:a}),t({type:"SET_UNIFORMS",payload:{tAudioData:{value:new s.d(a.data,i/2,1,s.f)}}});case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),animate:function(){e.analyser.getFrequencyData(),e.uniforms.tAudioData.value.needsUpdate=!0}}}(d,l[1]),h={state:d,actions:f};return a.a.createElement(O.Provider,{value:h},i)},E={loading:!0},k=function(e,t){switch(t.type){case"SET_LOADING":return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){Object(i.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{loading:t.payload})}},U=function(e){var t=e.url;console.log("container");var n=Object(r.useContext)(O),i=(n.state,n.actions,Object(r.useRef)(null)),c=Object(r.useState)(null),u=Object(o.a)(c,2),v=u[0],l=u[1],d=Object(r.useState)(!1),f=Object(o.a)(d,2),h=f[0],p=f[1],m=Object(r.useRef)(null);return Object(r.useEffect)((function(){l({points:[{x:0,y:0,z:0}]}.points)}),[]),Object(r.useEffect)((function(){if(console.log(v),v){var e,n=i.current.clientWidth,o=i.current.clientHeight,r=v.map((function(e,t){return{geometry:new s.l(100,10,6),name:"disco-ball-".concat(t),position:e,vectorFieldConfig:"LORENZ"}}));r.push({geometry:new s.i(50,50,50),name:"floor",position:{x:0,y:0,z:-10},vertexShader:"#define GLSLIFY 1\nvarying vec4 vUv;\nuniform sampler2D tAudioData;\nvarying vec3 newPosition;\n\nfloat rand(vec2 co){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvoid main() {\n  float dist = distance(position, vec3(0,0, position.z));\n  float f1 = texture2D(tAudioData, vec2(position.y, position.x)).g;\n  float f2 = texture2D(tAudioData, vec2(position.x, position.y)).g;\n  float M_PI = 3.1415926535897932384626433832795;\n  //float f =  texture2D( tAudioData, vec2( 0.5 + 0.5 * sin(M_PI * position.x) * cos(2.0 * M_PI * position.y), 0.0) ).g;\n\t\t      \n  newPosition = vec3(position.x, position.y, 5.0* step(f1,rand(position.xy)));\n  //vUv = vec4(position.x, position.y, 10.0 * sin(2.0 * position.x), 1.0);\n  vUv = vec4(position, 1.0);\n  \n  vec4 modelViewPosition = modelViewMatrix * vec4(newPosition, 1.0);\n  gl_Position = projectionMatrix * modelViewPosition;\n}\n",fragmentShader:"#define GLSLIFY 1\nvarying vec4 vUv;\nuniform vec4 params;\nuniform float time;\n\n// adapted from https://thebookofshaders.com/edit.php#10/ikeda-simple-grid.frag\n \nfloat grid(vec2 st, float res)\n{\n  float motion = fract(time);\n  vec2 grid = fract(st*res);\n  return (step(res, grid.x) * step(res, grid.y));\n}\n \nvoid main()\n{\n  vec2 grid_uv = vec2(vUv.x * 0.5, vUv.y * 0.5 + fract(time) * 10.0); //params.x; // scale\n  float x = grid(grid_uv, 0.2);//params.y); // resolution\n  gl_FragColor.rgb = vec3(0.5, 0.4, 0.1) * (1.0 - x);  \n  gl_FragColor.a = 1.0;\n} \n"});var a=new z({width:n,height:o,models:r});console.log("url",t),a.loadAudioObject({url:t}).then((function(e){var t=e.uniforms;a.loadMeshes(t)}));var c=function(){a.handleResize(i.current.clientWidth,i.current.clientHeight)},u=function t(){a.renderScene(),e=window.requestAnimationFrame(t)},l=function(){cancelAnimationFrame(e),a.pause(),e=null};return i.current.appendChild(a.renderer.domElement),window.addEventListener("resize",c),m.current={start:function(){e||(a.play(),e=requestAnimationFrame(u))},stop:l},function(){l(),window.removeEventListener("resize",c)}}}),[v]),Object(r.useEffect)((function(){}),[]),Object(r.useEffect)((function(){try{h?m.current.start():m.current.stop()}catch(e){console.log("waiyting for media")}}),[h]),a.a.createElement("div",{className:"container",ref:i,onClick:function(){return p(!h)}})},M=function(e){var t=e.url;return a.a.createElement(j,{initialState:E,reducer:k},a.a.createElement(U,{url:t}))};n.d(t,"Container",(function(){return U})),n.d(t,"AudioContainer",(function(){return M}))},8:function(e,t,n){e.exports=n(12)}},[[8,1,2]]]);
//# sourceMappingURL=main.e9c6aba2.chunk.js.map